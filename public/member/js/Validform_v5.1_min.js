(function(J,H,E){var I=null,B=null,D=true;var A={tit:"提示信息",w:"请输入正确信息！",r:"通过信息验证！",c:"正在检测信息…",s:"请填入信息！",v:"所填信息没有经过验证，请稍后…",p:"正在提交数据…",err:"出错了！请检查提交地址或返回数据格式是否正确！",abort:"Ajax操作被取消！"};J.Tipmsg=A;var G=function(L,K,N){var K=J.extend({},G.defaults,K);K.datatype&&J.extend(G.util.dataType,K.datatype);var M=this;M.tipmsg={};M.settings=K;M.forms=L;M.objects=[];if(N===true){return false}L.each(function(O){var P=J(this);this.status="normal";P.data("tipmsg",M.tipmsg);P.find("[datatype]").live("blur",function(){var S=arguments[1];var T=G.util.getValue.call(P,J(this));if(J(this).data("dataIgnore")==="dataIgnore"||K.dragonfly&&!J(this).data("cked")&&G.util.isEmpty.call(J(this),T)){return false}var Q=true,U;I=U=J(this);Q=G.util.regcheck.call(P,J(this).attr("datatype"),T,J(this));if(!Q.passed){G.util.abort.call(U[0]);U.addClass("Validform_error");G.util.showmsg.call(P,Q.info,K.tiptype,{obj:J(this),type:Q.type,sweep:K.tipSweep},"hide")}else{if(J(this).attr("ajaxurl")){var R=J(this);if(R[0].valid==="posting"){return false}R[0].valid="posting";G.util.showmsg.call(P,M.tipmsg.c||A.c,K.tiptype,{obj:R,type:1,sweep:K.tipSweep},"hide");G.util.abort.call(U[0]);U[0].ajax=J.ajax({type:"POST",cache:false,url:R.attr("ajaxurl"),data:"param="+T+"&name="+J(this).attr("name"),dataType:"text",success:function(V){if(J.trim(V)=="y"){R[0].valid="true";G.util.showmsg.call(P,M.tipmsg.r||A.r,K.tiptype,{obj:R,type:2,sweep:K.tipSweep},"hide");U.removeClass("Validform_error");I=null;if(S==="postform"){P.trigger("submit")}}else{R[0].valid=V;U.addClass("Validform_error");G.util.showmsg.call(P,V,K.tiptype,{obj:R,type:3,sweep:K.tipSweep})}U[0].ajax=null},error:function(){R[0].valid=M.tipmsg.err||A.err;U.addClass("Validform_error");U[0].ajax=null;G.util.showmsg.call(P,M.tipmsg.err||A.err,K.tiptype,{obj:R,type:3,sweep:K.tipSweep})}})}else{G.util.showmsg.call(P,Q.info,K.tiptype,{obj:J(this),type:Q.type,sweep:K.tipSweep},"hide");U.removeClass("Validform_error");I=null}}});G.util.hasDefaultText.call(P);G.util.recheckEnhance.call(P);if(K.usePlugin){G.util.usePlugin.call(P,K.usePlugin,K.tiptype,K.tipSweep,O)}P.find(":checkbox[datatype],:radio[datatype]").each(function(){var Q=J(this);var R=Q.attr("name");P.find("[name='"+R+"']").filter(":checkbox,:radio").bind("click",function(){setTimeout(function(){Q.trigger("blur")},0)})});K.btnSubmit&&P.find(K.btnSubmit).bind("click",function(){var Q=G.util.submitForm.call(P,K);Q===E&&(Q=true);if(Q===true){P[0].submit()}});P.submit(function(){var Q=G.util.submitForm.call(P,K);Q===E&&(Q=true);return Q});P.find("[type='reset']").add(P.find(K.btnReset)).bind("click",function(){G.util.resetForm.call(P)})});if(K.tiptype==1||(K.tiptype==2&&K.ajaxPost)){F()}};G.defaults={tiptype:1,tipSweep:false,showAllError:false,postonce:false,ajaxPost:false};G.util={dataType:{match:/^(.+?)(\d+)-(\d+)$/,"*":/[\w\W]+/,"*6-16":/^[\w\W]{6,16}$/,n:/^\d+$/,"n6-16":/^\d{6,16}$/,s:/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]+$/,"s6-18":/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{6,18}$/,p:/^[0-9]{6}$/,m:/^13[0-9]{9}$|15[0-9]{9}$|18[0-9]{9}$/,e:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,url:/^(\w+:\/\/)?\w+(\.\w+)+.*$/},toString:Object.prototype.toString,getValue:function(L){var K,M=this;if(L.is(":radio")){K=M.find(":radio[name='"+L.attr("name")+"']:checked").val();K=K===E?"":K}else{if(L.is(":checkbox")){K=M.find(":checkbox[name='"+L.attr("name")+"']:checked").val();K=K===E?"":K}else{K=L.val()}}return J.trim(K)},isEmpty:function(K){return K===""||K===J.trim(this.attr("tip"))},recheckEnhance:function(){var K=this;K.find("input[recheck]").each(function(){var M=J(this);var L=K.find("input[name='"+J(this).attr("recheck")+"']");L.bind("keyup",function(){if(L.val()==M.val()&&L.val()!=""){if(L.attr("tip")){if(L.attr("tip")==L.val()){return false}}M.trigger("blur")}}).bind("blur",function(){if(L.val()!=M.val()&&M.val()!=""){if(M.attr("tip")){if(M.attr("tip")==M.val()){return false}}M.trigger("blur")}})})},hasDefaultText:function(){this.find("[tip]").each(function(){var K=J(this).attr("tip");var L=J(this).attr("altercss");J(this).focus(function(){if(J(this).val()==K){J(this).val("");if(L){J(this).removeClass(L)}}}).blur(function(){if(J.trim(J(this).val())===""){J(this).val(K);if(L){J(this).addClass(L)}}})})},usePlugin:function(L,T,N,S){var O=this;if(L.swfupload){var M=O.find("input[plugin='swfupload']").val(""),R={custom_settings:{form:O,showmsg:function(W,V){G.util.showmsg.call(O,W,T,{obj:M,type:V,sweep:N})}}};R=J.extend(true,{},L.swfupload,R);if(typeof(swfuploadhandler)!="undefined"){swfuploadhandler.init(R,S)}}if(L.datepicker){if(L.datepicker.format){Date.format=L.datepicker.format;delete L.datepicker.format}if(L.datepicker.firstDayOfWeek){Date.firstDayOfWeek=L.datepicker.firstDayOfWeek;delete L.datepicker.firstDayOfWeek}var K=O.find("input[plugin='datepicker']");L.datepicker.callback&&K.bind("dateSelected",function(){var V=new Date(J.event._dpCache[this._dpId].getSelected()[0]).asString(Date.format);L.datepicker.callback(V,this)});K.datePicker(L.datepicker)}if(L.passwordstrength){L.passwordstrength.showmsg=function(W,X,V){G.util.showmsg.call(O,X,T,{obj:W,type:V,sweep:N},"hide")};O.find("input[plugin*='passwordStrength']").passwordStrength(L.passwordstrength)}if(L.jqtransform){var U=function(V){var W=J(".jqTransformSelectWrapper ul:visible");W.each(function(){var X=J(this).parents(".jqTransformSelectWrapper:first").find("select").get(0);if(!(V&&X.oLabel&&X.oLabel.get(0)==V.get(0))){J(this).hide()}})};var P=function(V){if(J(V.target).parents(".jqTransformSelectWrapper").length===0){U(J(V.target))}};var Q=function(){J(document).mousedown(P)};if(L.jqtransform.selector){O.find(L.jqtransform.selector).filter('input:submit, input:reset, input[type="button"]').jqTransInputButton();O.find(L.jqtransform.selector).filter("input:text, input:password").jqTransInputText();O.find(L.jqtransform.selector).filter("input:checkbox").jqTransCheckBox();O.find(L.jqtransform.selector).filter("input:radio").jqTransRadio();O.find(L.jqtransform.selector).filter("textarea").jqTransTextarea();if(O.find(L.jqtransform.selector).filter("select").length>0){O.find(L.jqtransform.selector).filter("select").jqTransSelect();Q()}}else{O.jqTransform()}O.find(".jqTransformSelectWrapper").find("li a").click(function(){O.find("select").trigger("blur")})}},regcheck:function(N,O,M){var P=this,W=null,U=false,R=3;if(M.attr("ignore")==="ignore"&&G.util.isEmpty.call(M,O)){if(M.data("cked")){W=""}return{passed:true,type:4,info:W}}M.data("cked","cked");if(J.trim(M.attr("tip"))&&O===J.trim(M.attr("tip"))){return{passed:false,type:3,info:M.attr("nullmsg")||P.data("tipmsg").s||A.s}}if(G.util.toString.call(G.util.dataType[N])=="[object Function]"){U=G.util.dataType[N](O,M,P,G.util.dataType);if(U===true){R=2;W=P.data("tipmsg").r||A.r;if(M.attr("recheck")){var V=P.find("input[name='"+M.attr("recheck")+"']:first");if(O!=V.val()){U=false;R=3;W=M.attr("errormsg")||P.data("tipmsg").w||A.w}}}else{W=U||M.attr("errormsg")||P.data("tipmsg").w||A.w;U=false;if(O===""){return{passed:false,type:3,info:M.attr("nullmsg")||P.data("tipmsg").s||A.s}}}return{passed:U,type:R,info:W}}if(!(N in G.util.dataType)){var L=N.match(G.util.dataType.match),X;if(!L){return false}for(var S in G.util.dataType){X=S.match(G.util.dataType.match);if(!X){continue}if(L[1]===X[1]){var Q=G.util.dataType[S].toString(),T=Q.match(/\/[mgi]*/g)[1].replace("/",""),K=new RegExp("\\{"+X[2]+","+X[3]+"\\}","g");Q=Q.replace(/\/[mgi]*/g,"/").replace(K,"{"+L[2]+","+L[3]+"}").replace(/^\//,"").replace(/\/$/,"");G.util.dataType[N]=new RegExp(Q,T);break}}}if(G.util.toString.call(G.util.dataType[N])=="[object RegExp]"){U=G.util.dataType[N].test(O);if(U){R=2;W=P.data("tipmsg").r||A.r;if(M.attr("recheck")){var V=P.find("input[name='"+M.attr("recheck")+"']:first");if(O!=V.val()){U=false;R=3;W=M.attr("errormsg")||P.data("tipmsg").w||A.w}}}else{W=M.attr("errormsg")||P.data("tipmsg").w||A.w;if(O===""){return{passed:false,type:3,info:M.attr("nullmsg")||P.data("tipmsg").s||A.s}}}return{passed:U,type:R,info:W}}return{passed:false,type:3,info:P.data("tipmsg").w||A.w}},showmsg:function(K,L,M,N){if(K===null){return false}J.extend(M,{curform:this});if(typeof L=="function"){if(!(M.sweep&&N=="hide")){L(K,M,G.util.cssctl)}return false}if(L==1||N=="alwaysshow"){B.find(".Validform_info").html(K)}if(L==1&&N!="hide"||N=="alwaysshow"){D=false;B.find(".iframe").css("height",B.outerHeight());B.show();C(B,100)}if(L==2&&M.obj){M.obj.parent().next().find(".Validform_checktip").html(K);G.util.cssctl(M.obj.parent().next().find(".Validform_checktip"),M.type)}},cssctl:function(K,L){switch(L){case 1:K.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");break;case 2:K.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");break;case 4:K.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");break;default:K.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong")}},submitForm:function(S,O,Q,N){var L=this;if(L[0].status==="posting"){return false}if(S.postonce&&L[0].status==="posted"){return false}var N=N===true?false:true;var K=S.beforeCheck&&S.beforeCheck(L);if(K===false){return false}var M=true,R;L.find("[datatype]").each(function(){if(O){return false}if(S.ignoreHidden&&J(this).is(":hidden")||J(this).data("dataIgnore")==="dataIgnore"){return true}var V=G.util.getValue.call(L,J(this)),T;I=T=J(this);R=G.util.regcheck.call(L,J(this).attr("datatype"),V,J(this));if(!R.passed){T.addClass("Validform_error");G.util.showmsg.call(L,R.info,S.tiptype,{obj:J(this),type:R.type,sweep:S.tipSweep});if(!S.showAllError){T.focus();M=false;return false}M&&(M=false);return true}if(J(this).attr("ajaxurl")){if(this.valid!=="true"){var U=J(this);T.addClass("Validform_error");G.util.showmsg.call(L,L.data("tipmsg").v||A.v,S.tiptype,{obj:U,type:3,sweep:S.tipSweep});if(!D||S.tiptype!=1){setTimeout(function(){U.trigger("blur",["postform"])},1500)}if(!S.showAllError){M=false;return false}M&&(M=false);return true}}G.util.showmsg.call(L,R.info,S.tiptype,{obj:J(this),type:R.type,sweep:S.tipSweep},"hide");T.removeClass("Validform_error");I=null});if(S.showAllError){L.find(".Validform_error:first").focus()}if(M){var P=S.beforeSubmit&&S.beforeSubmit(L);if(P===false){return false}L[0].status="posting";if(S.ajaxPost||Q==="ajaxPost"){G.util.showmsg.call(L,L.data("tipmsg").p||A.p,S.tiptype,{obj:L,type:1,sweep:S.tipSweep},"alwaysshow");L[0].ajax=J.ajax({type:"POST",dataType:"json",async:N,url:L.attr("action"),data:L.serializeArray(),success:function(T){if(T.status==="y"){G.util.showmsg.call(L,T.info,S.tiptype,{obj:L,type:2,sweep:S.tipSweep},"alwaysshow")}else{L[0].posting=false;G.util.showmsg.call(L,T.info,S.tiptype,{obj:L,type:3,sweep:S.tipSweep},"alwaysshow")}S.callback&&S.callback(T);L[0].status="posted";L[0].ajax=null},error:function(T){var U=T.statusText==="abort"?L.data("tipmsg").abort||A.abort:L.data("tipmsg").err||A.err;L[0].posting=false;G.util.showmsg.call(L,U,S.tiptype,{obj:L,type:3,sweep:S.tipSweep},"alwaysshow");L[0].status="normal";L[0].ajax=null}})}else{if(!S.postonce){L[0].status="normal"}return S.callback&&S.callback(L)}}return false},resetForm:function(){var K=this;K.each(function(){this.reset();this.status="normal"});K.find(".Validform_right").text("");K.find(".passwordStrength").children().removeClass("bgStrength");K.find(".Validform_checktip").removeClass("Validform_wrong Validform_right Validform_loading");K.find(".Validform_error").removeClass("Validform_error");K.find("[datatype]").removeData("cked").removeData("dataIgnore");K.eq(0).find("input:first").focus()},abort:function(){if(this.ajax){this.ajax.abort()}}};J.Datatype=G.util.dataType;G.prototype={dataType:G.util.dataType,eq:function(K){var L=this;if(K>=L.forms.length){return null}if(!(K in L.objects)){L.objects[K]=new G(J(L.forms[K]).get(),L.settings,true)}return L.objects[K]},resetStatus:function(){var K=this;J(K.forms).each(function(){this.status="normal"});return this},setStatus:function(L){var K=this;J(K.forms).each(function(){this.status=L||"posting"})},getStatus:function(){var K=this;var L=J(K.forms)[0].status;return L},ignore:function(L){var K=this;J(K.forms).find(L).each(function(){J(this).data("dataIgnore","dataIgnore").removeClass("Validform_error")})},unignore:function(L){var K=this;J(K.forms).find(L).each(function(){J(this).removeData("dataIgnore")})},addRule:function(K){var N=this;var K=K||[];for(var M in K){var L=J(N.forms).find(K[M].ele);for(var O in K[M]){O!=="ele"&&L.attr(O,K[M][O])}}},ajaxPost:function(M,K){var L=this;if(L.settings.tiptype==1||L.settings.tiptype==2){F()}G.util.submitForm.call(J(L.forms[0]),L.settings,M,"ajaxPost",K)},submitForm:function(M){var L=this;var K=G.util.submitForm.call(J(L.forms[0]),L.settings,M);K===E&&(K=true);if(K===true){L.forms[0].submit()}},resetForm:function(){var K=this;G.util.resetForm.call(J(K.forms))},abort:function(){var K=this;J(K.forms).each(function(){G.util.abort.call(this)})}};J.fn.Validform=function(K){return new G(this,K)};function C(K,M){var L=(J(window).width()-K.outerWidth())/2,N=(J(window).height()-K.outerHeight())/2,N=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(N>0?N:0);K.css({left:L}).animate({top:N},{duration:M,queue:false})}function F(){if(J("#Validform_msg").length!==0){return false}B=J('<div id="Validform_msg"><div class="Validform_title">'+A.tit+'<a class="Validform_close" href="javascript:void(0);">&chi;</a></div><div class="Validform_info"></div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"></iframe></div></div>').appendTo("body");B.find("a.Validform_close").click(function(){B.hide();D=true;if(I){I.focus().addClass("Validform_error")}return false}).focus(function(){this.blur()});J(window).bind("scroll resize",function(){!D&&C(B,400)})}J.Showmsg=function(K){F();G.util.showmsg.call(H,K,1,{})};J.Hidemsg=function(){B.hide();D=true}})(jQuery,window);